}
# Tablas de mortalidad #########################################################
probsH<- unname(unlist(read_excel("Probabilidades_Ecuador_2023_2060.xlsx",
sheet=1)[,c(3)]))
probsM<- unname(unlist(read_excel("Probabilidades_Ecuador_2023_2060.xlsx",
sheet=2)[,c(3)]))
ls("package:lifecontingencies")
TH <- probs2lifetable(probs=probsH, radix=100000, type="qx", name = "Mortalidad Hombres")
TM <- probs2lifetable(probs=probsM, radix=100000, type="qx", name = "Mortalidad Mujeres")
# Crecimiento de la reserva ( cotizaciones ) ###################################
ev_res <- data.frame(
anio = c(anio_inicio:anio_fin),
edad = c(edad_inicio:(edad_jubilacion-1)),
res_acum = numeric(num_anios)
)
for (j in c(1:num_anios)) {
ev_res[j,3] <-  VSn(C = (salario_ini * IVM ) * annuity(i = crec_SBU_12, n=12, type = "immediate"),
q = (1+crec_SBU) ,
n = j , #años de aporte hasta el momento
i = i_actuarial,
type = "due")
}
# Decrecimiento de la reserv ( pensiones ) #####################################
pen <- Pension(edad_inicio, salario_ini, num_anios)[[1]]
ahorro_total_inicial <- ev_res[nrow(ev_res),3]
ahorro_total_inicial
20/7
source("~/TIC/Shiny-TIC/guias_shiny/EvolucionReserva.R", echo=TRUE)
runApp()
<<<<<<< HEAD
load("~/TIC/Shiny-TIC/.RData")
load("~/TIC/Shiny-TIC/obtencion_pension_prom.Rdata")
View(pensiones2)
# Creación de índices de la base de datos
load("obtencion_pension_prom.Rdata")
names(pensiones2)
library(highcharter)
library(lubridate)
library(lifecontingencies)
library(openxlsx)
library(readxl)
library(tidyverse)
library(data.table)
names(pensiones2)
unique(pensiones2$tipo_beneficiario)
fecha_derecho <-
pensiones2$fecha_derecho
pensiones2$fecha_derecho
fecha_derecho <-
class(pensiones2$fecha_derecho)
class(pensiones2$fecha_derecho)
names(pensiones2)
pensiones2$ano
names(pensiones2)
pensiones2$fecha_derecho
names(pensiones2)
unique(pensiones2$sexo)
sum(pensiones2$edad>=pensiones2$edad_jubilacion)
sum(pensiones2$edad<=pensiones2$edad_jubilacion)
sum(pensiones2$edad>pensiones2$edad_jubilacion)
sum(pensiones2$edad<pensiones2$edad_jubilacion)
sum(pensiones2$edad==pensiones2$edad_jubilacion)
pensiones2$edad > pensiones2$edad_jubilacion
pensiones2 %>% filter(sexo=="F") %>% summarise(fecha_inicial_pension)
pensiones2 %>% filter(sexo=="F") %>% summary(fecha_inicial_pension)
pensiones2 %>% filter(sexo=="F") %>% summary(ymd(fecha_inicial_pension))
pensiones2 %>% filter(sexo=="F") %>%
select(edad) %>%  summary()
pensiones2$coeficiente_real
pensiones2 %>% filter(sexo=="F") %>%
select(ymd(fecha_nacimiento_concesion),
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
ymd(fecha_derecho),
ymd(fecha_inicial_pension),
edad,
ymd(fecha_final_pension)
) %>%  summary()
class(pensiones2$fecha_nacimiento_concesion)
pensiones2 %>% filter(sexo=="F") %>%
select(fecha_nacimiento_concesion,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
edad,
fecha_final_pension
) %>%  summary()
2024-1911
quantile(pensiones2$fecha_nacimiento_concesion,probs = seq(0,1,0.1))
quantile(pensiones2$edad,probs = seq(0,1,0.1))
which(pensiones2$edad == 108)
pensiones2$fecha_nacimiento_concesion[27128]
pensiones2$fecha_nacimiento_concesion[27128]+108
pensiones2$fecha_nacimiento_concesion[27128]+108*365
"2019-08-14"-"2024-07-15"
ymd("2019-08-14")-ymd("2024-07-15")
1797/365
ymd("2019-08-14")-ymd("1911-12-27")
39312/365
today()
ymd(today()-"2019-08-14")
source("~/.active-rstudio-document", echo=TRUE)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>%
filter(edad_hoy<=108) %>%
select(edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
edad,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>%
filter(edad_hoy<=108) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 )
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>% select(edad_hoy)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>% select(edad_hoy)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
names(pensiones2)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
which(pensiones2$edad_jubilacion == 47.00)
pensiones2$numero_imposiciones_totales[5291]/12
pensiones2$numero_imposiciones_totales[23925]/12
pensiones2$numero_imposiciones_totales[44397]/12
pensiones2$numero_imposiciones_totales[44481]/12
pensiones2$numero_imposiciones_totales[44578]/12
pensiones2$coeficiente_real[5291]/12
pensiones2$coeficiente_real[23925]/12
pensiones2$coeficiente_real[44397]/12
pensiones2$coeficiente_real[44481]/12
pensiones2$coeficiente_real[44578]/12
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension
) %>%  summary()
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension
) %>%  summary()
fwrite(pen_fem,file = pen_fem.xlsx)
fwrite(pen_fem,file = "pen_fem.xlsx")
class(pen_fem)
fwrite(as.data.frame(pen_fem),file = "pen_fem.xlsx")
as.data.frame(pen_fem)
data.frame(pen_fem)
fwrite(data.frame(pen_fem),file = "pen_fem.xlsx")
pen_fem
str(pen_fem)
view(pen_fem)
pensiones2$valor_acumulado
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_derecho)-ymd(fecha_inicial_pension))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pensiones2 %>% select(fecha_inicial_pension,fecha_derecho) %>% mutate(adc=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
view(pensiones2 %>% select(fecha_inicial_pension,fecha_derecho) %>% mutate(adc=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365)))
# Indicadores sobre población pensionada ---------------------------------------
pensiones2 <- pensiones2 %>% mutate(anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
View(pensiones2)
names(pensiones2)
which(pensiones2$anios_derecho_concedido <0)
pensiones2$anios_derecho_concedido[27747]
pensiones2$anios_derecho_concedido[27885]
pensiones2$anios_derecho_concedido[28203]
pensiones2$anios_derecho_concedido[28258]
pensiones2$anios_derecho_concedido[28273]
pensiones2$anios_derecho_concedido[28501]
pensiones2$anios_derecho_concedido[28517]
# Indicadores sobre población pensionada ---------------------------------------
pensiones2 <- pensiones2 %>% mutate(anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pensiones2$numero_imposiciones_totales
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.1))
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.05))
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.01))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18,
promedio_sueldo_real>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
quantile(pensiones2$promedio_sueldo_real,probs = seq(0,1,0.01))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
which(pensiones2$numero_imposiciones_totales==60)
pensiones2$edad_jubilacion[782]
a <- which(pensiones2$numero_imposiciones_totales==60)
pensiones2$edad_jubilacion[a]
summary(pensiones2$edad_jubilacion[a])
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.01))
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.005))
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.01))
quantile(pensiones2$valor_pension_concedida,probs = seq(0,1,0.01))
a <- which(pensiones2$valor_pension_concedida==10.9000)
which(pensiones2$valor_pension_concedida==10.9000)
pensiones2$fecha_nacimiento_concesion[419]
2024-1932
quantile(pensiones2$fecha_inicial_pension,probs = seq(0,1,0.01))
quantile(pensiones2$ymd(fecha_inicial_pension),probs = seq(0,1,0.01))
quantile(ymd(pensiones2$fecha_inicial_pension),probs = seq(0,1,0.01))
summary(ymd(pensiones2$fecha_inicial_pension),probs = seq(0,1,0.01))
files()
list.files()
load("bases_originales/bases_cotizacion.Rdata")
load("bases_originales/bases_cotizacion.Rdata")
load("bases_originales/afiliados.Rdata")
load("~/TIC/Shiny-TIC/bases_originales/KSRECTPLANILLAS.RData")
View(ev_res2)
View(KSRECTPLANILLAS)
load("bases_originales/KSRECTPLANILLAS.RData")
names(bases_cotizacion)
names(afiliados)
afiliados$estafi
names(afiliados)
unique(afiliados$numjub)
names(KSRECTPLANILLAS)
summary(bases_cotizacion$sexo)
summarise(bases_cotizacion$sexo)
summary(as.factor(bases_cotizacion$sexo))
summary(as.factor(afiliados$sexo))
summarise(as.factor(afiliados$sexo))
722667(722667 + 1046075)
722667/(722667 + 1046075)
1046075/(722667 + 1046075)
#bases
552962 / (552962 + 710690)
710690 / (552962 + 710690)
100-40.86
summary(pensiones2$sexo)
summary(as.factor(pensiones2$sexo))
18059/(18059 + 27778 )
100-39.40
summarise(bases_cotizacion$valaponor)
summary(bases_cotizacion$valaponor)
summary(as.factor(afiliados$edad))
summary(afiliados$edad)
summary(as.factor(afiliados$estfal))
summary(ymd(afiliados$feciniafi))
afiliados %>% filter(estfal==0) %>% select(feciniafi) %>% summarise()
afiliados %>% filter(estfal==0) %>% select(feciniafi) %>% summary()
which(afiliados$feciniafi=="0101-03-20")
summary(afiliados$numimptot)
afiliados %>% filter(estfal==0) %>% select(numimptot) %>% summary()
summary(afiliados$numimp)
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summary()
a <- afiliados %>% filter(estfal==0) %>% select(numimp)
quantile(a,probs = seq(0,1,0.1))
a <- afiliados %>% filter(estfal==0) %>% select(numimp)
quantile(a,probs = seq(0,1,0.1))
a
quantile(as.vector(a),probs = seq(0,1,0.1))
class(a)
str(a)
quantile(a[1,],probs = seq(0,1,0.1))
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
summary(as.factor(afiliados$estfal))
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0.1),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0.1),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0,numimp>0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0,numimp>0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1),
mean = mean(numimp)
)
=======
shiny::runApp()
shiny::runApp()
>>>>>>> 386a2893c23d29648657741e475b4adf373e932a
