<<<<<<< HEAD
type = "line",styled = TRUE,
hcaes(x = x,
y = y)) %>%
hc_title(text = "Impacto del Porcentaje de Aportación del Estado en la Sostenibilidad de las Pensiones") %>%
hc_subtitle(text = "Análisis de Tendencias y Proyecciones") %>%
hc_xAxis(title = list(text = "Porcentaje de Aportación del Estado")) %>%
hc_yAxis(title = list(text = "Número de años antes de alcanzar el déficit")) %>%
hc_add_theme(hc_theme_darkunica())
})
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(80123, 123150 ,722 , i))
=======
>>>>>>> c560e7cc15453284badb8f598369c196a66a2493
}
# Tablas de mortalidad #########################################################
probsH<- unname(unlist(read_excel("Probabilidades_Ecuador_2023_2060.xlsx",
sheet=1)[,c(3)]))
probsM<- unname(unlist(read_excel("Probabilidades_Ecuador_2023_2060.xlsx",
sheet=2)[,c(3)]))
ls("package:lifecontingencies")
TH <- probs2lifetable(probs=probsH, radix=100000, type="qx", name = "Mortalidad Hombres")
TM <- probs2lifetable(probs=probsM, radix=100000, type="qx", name = "Mortalidad Mujeres")
# Crecimiento de la reserva ( cotizaciones ) ###################################
ev_res <- data.frame(
anio = c(anio_inicio:anio_fin),
edad = c(edad_inicio:(edad_jubilacion-1)),
res_acum = numeric(num_anios)
)
for (j in c(1:num_anios)) {
ev_res[j,3] <-  VSn(C = (salario_ini * IVM ) * annuity(i = crec_SBU_12, n=12, type = "immediate"),
q = (1+crec_SBU) ,
n = j , #años de aporte hasta el momento
i = i_actuarial,
type = "due")
}
<<<<<<< HEAD
if (t > max_iter) {
return(100)
} else {
return(i)
}
}
}
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 10/100
i_12 <- (1+(10/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0 && t <= max_iter){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 10/100
i_12 <- (1+(10/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
y
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 6.25/100
i_12 <- (1+(6.25/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
y
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 6.25/100
i_12 <- (1+(6.25/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (!is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (i in 0:40){
y <- c
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
y
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 6.25/100
i_12 <- (1+(6.25/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (!is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (i in 0:40){
y <- c(y , fun_anio_deficit(8110123, 123150 ,722 , i))
}
y
if(is.finite(100)){print(199)}
if(!is.finite(100)){print(199)}
y <- c()
for (k in 0:40){
y <- c(y , fun_anio_deficit(80123, 123150 ,722 , k))
}
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 6.25/100
i_12 <- (1+(6.25/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (!is.finite(ahorro)) {
return(100)
}
}
return(i)
}
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 6.25/100
i_12 <- (1+(6.25/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (!is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
for (k in 0:40){
y <- c(y , fun_anio_deficit(80123, 123150 ,722 , k))
}
y
fun_anio_deficit<- function (ahorro, va_pensiones, pension_inicial, porcentaje_estado){
ahorro <- ahorro + (porcentaje_estado/100)* va_pensiones
crec_pensiones <- 1.8261/100
interes <- 10/100
i_12 <- (1+(10/100))^(1/12) - 1
pension <- pension_inicial * annuity(i = i_12, n=12, type = "due")
i <- 1
while((ahorro - pension) > 0){
ahorro <- (ahorro - pension)* (1 + interes)
pension <- pension * (1+ crec_pensiones)
i <- i + 1
if (!is.finite(ahorro)) {
return(100)
}
}
return(i)
}
y <- c()
y <- c()
for (k in 0:40){
y <- c(y , fun_anio_deficit(80123, 123150 ,722 , k))
}
y
runApp()
# Crear gráfico de Highcharts
data %>%
hchart(.,
type = "line",styled = TRUE,
name= 'Edad del jubilado',
hcaes(x = x,
y = y)) %>%
hc_title(text = "Impacto del Porcentaje de Aportación del Estado en la Sostenibilidad de las Pensiones") %>%
hc_subtitle(text = "Edad del jubilado donde se terminarían los recursos para el pago de su pensión según el porcentaje de aporte del Estado") %>%
hc_xAxis(title = list(text = "Porcentaje de Aportación del Estado")) %>%
hc_yAxis(title = list(text = "Edad del jubilado donde se alcanza el déficit")) %>%
hc_add_theme(hc_theme_elementary())
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
# load("C:/Users/MyHP/Desktop/TIC/Shiny-TIC/obtencion_pension_prom.Rdata") #Taynita
=======
# Decrecimiento de la reserv ( pensiones ) #####################################
pen <- Pension(edad_inicio, salario_ini, num_anios)[[1]]
ahorro_total_inicial <- ev_res[nrow(ev_res),3]
ahorro_total_inicial
20/7
source("~/TIC/Shiny-TIC/guias_shiny/EvolucionReserva.R", echo=TRUE)
runApp()
<<<<<<< HEAD
load("~/TIC/Shiny-TIC/.RData")
load("~/TIC/Shiny-TIC/obtencion_pension_prom.Rdata")
View(pensiones2)
# Creación de índices de la base de datos
>>>>>>> c560e7cc15453284badb8f598369c196a66a2493
load("obtencion_pension_prom.Rdata")
names(pensiones2)
library(highcharter)
library(lubridate)
library(lifecontingencies)
library(openxlsx)
library(readxl)
library(tidyverse)
library(data.table)
names(pensiones2)
unique(pensiones2$tipo_beneficiario)
fecha_derecho <-
pensiones2$fecha_derecho
pensiones2$fecha_derecho
fecha_derecho <-
class(pensiones2$fecha_derecho)
class(pensiones2$fecha_derecho)
names(pensiones2)
pensiones2$ano
names(pensiones2)
pensiones2$fecha_derecho
names(pensiones2)
unique(pensiones2$sexo)
sum(pensiones2$edad>=pensiones2$edad_jubilacion)
sum(pensiones2$edad<=pensiones2$edad_jubilacion)
sum(pensiones2$edad>pensiones2$edad_jubilacion)
sum(pensiones2$edad<pensiones2$edad_jubilacion)
sum(pensiones2$edad==pensiones2$edad_jubilacion)
pensiones2$edad > pensiones2$edad_jubilacion
pensiones2 %>% filter(sexo=="F") %>% summarise(fecha_inicial_pension)
pensiones2 %>% filter(sexo=="F") %>% summary(fecha_inicial_pension)
pensiones2 %>% filter(sexo=="F") %>% summary(ymd(fecha_inicial_pension))
pensiones2 %>% filter(sexo=="F") %>%
select(edad) %>%  summary()
pensiones2$coeficiente_real
pensiones2 %>% filter(sexo=="F") %>%
select(ymd(fecha_nacimiento_concesion),
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
ymd(fecha_derecho),
ymd(fecha_inicial_pension),
edad,
ymd(fecha_final_pension)
) %>%  summary()
class(pensiones2$fecha_nacimiento_concesion)
pensiones2 %>% filter(sexo=="F") %>%
select(fecha_nacimiento_concesion,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
edad,
fecha_final_pension
) %>%  summary()
2024-1911
quantile(pensiones2$fecha_nacimiento_concesion,probs = seq(0,1,0.1))
quantile(pensiones2$edad,probs = seq(0,1,0.1))
which(pensiones2$edad == 108)
pensiones2$fecha_nacimiento_concesion[27128]
pensiones2$fecha_nacimiento_concesion[27128]+108
pensiones2$fecha_nacimiento_concesion[27128]+108*365
"2019-08-14"-"2024-07-15"
ymd("2019-08-14")-ymd("2024-07-15")
1797/365
ymd("2019-08-14")-ymd("1911-12-27")
39312/365
today()
ymd(today()-"2019-08-14")
source("~/.active-rstudio-document", echo=TRUE)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>%
filter(edad_hoy<=108) %>%
select(edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
edad,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>%
filter(edad_hoy<=108) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 )
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>% select(edad_hoy)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365 ) %>% select(edad_hoy)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
names(pensiones2)
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
which(pensiones2$edad_jubilacion == 47.00)
pensiones2$numero_imposiciones_totales[5291]/12
pensiones2$numero_imposiciones_totales[23925]/12
pensiones2$numero_imposiciones_totales[44397]/12
pensiones2$numero_imposiciones_totales[44481]/12
pensiones2$numero_imposiciones_totales[44578]/12
pensiones2$coeficiente_real[5291]/12
pensiones2$coeficiente_real[23925]/12
pensiones2$coeficiente_real[44397]/12
pensiones2$coeficiente_real[44481]/12
pensiones2$coeficiente_real[44578]/12
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension,
fecha_final_pension
) %>%  summary()
pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension
) %>%  summary()
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365) ) %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
fecha_inicial_pension
) %>%  summary()
fwrite(pen_fem,file = pen_fem.xlsx)
fwrite(pen_fem,file = "pen_fem.xlsx")
class(pen_fem)
fwrite(as.data.frame(pen_fem),file = "pen_fem.xlsx")
as.data.frame(pen_fem)
data.frame(pen_fem)
fwrite(data.frame(pen_fem),file = "pen_fem.xlsx")
pen_fem
str(pen_fem)
view(pen_fem)
pensiones2$valor_acumulado
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_derecho)-ymd(fecha_inicial_pension))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pensiones2 %>% select(fecha_inicial_pension,fecha_derecho) %>% mutate(adc=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
view(pensiones2 %>% select(fecha_inicial_pension,fecha_derecho) %>% mutate(adc=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365)))
# Indicadores sobre población pensionada ---------------------------------------
pensiones2 <- pensiones2 %>% mutate(anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
View(pensiones2)
<<<<<<< HEAD
unique(pensiones2$tipo_prestacion)
unique(pensiones1$tipo_prestacion)
unique(pensiones$tipo_prestacion)
unique(pensiones1$tipo_seguro)
names(pensioens)
names(pensiones)
sum(is.na(pensiones2$promedio_sueldo_real))
runApp()
# load("C:/Users/MyHP/Desktop/TIC/Shiny-TIC/obtencion_pension_prom.Rdata") #Taynita
load("obtencion_pension_prom.Rdata")
pensiones2 <- pensiones2 %>%  mutate( prom_salario_a_usar = promedio_sueldo_real *(1.02154)^(2024 - as.numeric(format(as.Date(fecha_inicial_pension, '%Y %m %d'), "%Y"))), .before=promedio_sueldo_real)
pensiones2 <- pensiones2 %>%  mutate(pension_final1 = pension_final *( 1.018261)^(5), .before=pension_final)
pensiones2 <- pensiones2 %>% mutate(pensionesfinal2 = pension_final1)
pensiones2 <- pensiones2 %>% dplyr::filter(tipo_seguro != 'SC')
pensiones2 <- pensiones2 %>% dplyr::filter(estado_vigencia=="A")
pensiones2 <- pensiones2 %>%
mutate(pensionesfinal2 = case_when(
0 <= numero_imposiciones & numero_imposiciones <= 10 * 12 ~ ifelse(pensionesfinal2 < 230, 230, pensionesfinal2),
11 * 12 <= numero_imposiciones & numero_imposiciones <= 20 * 12 ~ ifelse(pensionesfinal2 < 276, 276, pensionesfinal2),
21 * 12 <= numero_imposiciones & numero_imposiciones <= 30 * 12 ~ ifelse(pensionesfinal2 < 322, 322, pensionesfinal2),
31 * 12 <= numero_imposiciones & numero_imposiciones <= 35 * 12 ~ ifelse(pensionesfinal2 < 368, 368, pensionesfinal2),
36 * 12 <= numero_imposiciones & numero_imposiciones <= 39 * 12 ~ ifelse(pensionesfinal2 < 414, 414, pensionesfinal2),
40 * 12 <= numero_imposiciones ~ ifelse(pensionesfinal2 < 460, 460, pensionesfinal2),
0 <= numero_imposiciones & numero_imposiciones <= 10 * 12 ~ ifelse(pensionesfinal2 > 1150, 1150, pensionesfinal2),
15 * 12 <= numero_imposiciones & numero_imposiciones <= 19 * 12 ~ ifelse(pensionesfinal2 > 1380, 1380, pensionesfinal2),
20 * 12 <= numero_imposiciones & numero_imposiciones <= 24 * 12 ~ ifelse(pensionesfinal2 > 1610, 1610, pensionesfinal2),
25 * 12 <= numero_imposiciones & numero_imposiciones <= 29 * 12 ~ ifelse(pensionesfinal2 > 1840, 1840, pensionesfinal2),
30 * 12 <= numero_imposiciones & numero_imposiciones <= 34 * 12 ~ ifelse(pensionesfinal2 > 2070, 2070, pensionesfinal2),
35 * 12 <= numero_imposiciones & numero_imposiciones <= 39 * 12 ~ ifelse(pensionesfinal2 > 2300, 2300, pensionesfinal2),
4 * 120 <= numero_imposiciones ~ ifelse(pensionesfinal2 > 2530, 2530, pensionesfinal2),
TRUE ~ pensionesfinal2
))
sum(is.na(pensiones2$sexo))
dim(pensiones2)
dim(pensiones)
sum(is.na(pensiones2$fecha_nacimiento_concesion))
sum(is.na(pensiones2$estado_vigencia))
sum(is.na(pensiones2$fecha_inicial_pension))
sum(is.na(pensiones2$valor_pension))
sum(is.na(pensiones2$valor_aumentos))
sum(is.na(pensiones2$numero_imposiciones_totales))
sum(is.na(pensiones2$tipo_seguro))
sum(is.na(pensiones2$tipo_prestacion))
sum(is.na(pensiones2$promedio_sueldo_real))
# load("C:/Users/MyHP/Desktop/TIC/Shiny-TIC/obtencion_pension_prom.Rdata") #Taynita
load("obtencion_pension_prom.Rdata")
pensiones2 <- pensiones2 %>%  mutate( prom_salario_a_usar = promedio_sueldo_real *(1.02154)^(2024 - as.numeric(format(as.Date(fecha_inicial_pension, '%Y %m %d'), "%Y"))), .before=promedio_sueldo_real)
pensiones2 <- pensiones2 %>%  mutate(pension_final1 = pension_final *( 1.018261)^(5), .before=pension_final)
pensiones2 <- pensiones2 %>% mutate(pensionesfinal2 = pension_final1)
pensiones2 <- pensiones2 %>% dplyr::filter(tipo_seguro != 'SC')
pensiones2 <- pensiones2 %>% dplyr::filter(estado_vigencia=="A")
pensiones2 <- pensiones2 %>%
mutate(pensionesfinal2 = case_when(
0 <= numero_imposiciones & numero_imposiciones <= 10 * 12 ~ ifelse(pensionesfinal2 < 230, 230, pensionesfinal2),
11 * 12 <= numero_imposiciones & numero_imposiciones <= 20 * 12 ~ ifelse(pensionesfinal2 < 276, 276, pensionesfinal2),
21 * 12 <= numero_imposiciones & numero_imposiciones <= 30 * 12 ~ ifelse(pensionesfinal2 < 322, 322, pensionesfinal2),
31 * 12 <= numero_imposiciones & numero_imposiciones <= 35 * 12 ~ ifelse(pensionesfinal2 < 368, 368, pensionesfinal2),
36 * 12 <= numero_imposiciones & numero_imposiciones <= 39 * 12 ~ ifelse(pensionesfinal2 < 414, 414, pensionesfinal2),
40 * 12 <= numero_imposiciones ~ ifelse(pensionesfinal2 < 460, 460, pensionesfinal2),
0 <= numero_imposiciones & numero_imposiciones <= 10 * 12 ~ ifelse(pensionesfinal2 > 1150, 1150, pensionesfinal2),
15 * 12 <= numero_imposiciones & numero_imposiciones <= 19 * 12 ~ ifelse(pensionesfinal2 > 1380, 1380, pensionesfinal2),
20 * 12 <= numero_imposiciones & numero_imposiciones <= 24 * 12 ~ ifelse(pensionesfinal2 > 1610, 1610, pensionesfinal2),
25 * 12 <= numero_imposiciones & numero_imposiciones <= 29 * 12 ~ ifelse(pensionesfinal2 > 1840, 1840, pensionesfinal2),
30 * 12 <= numero_imposiciones & numero_imposiciones <= 34 * 12 ~ ifelse(pensionesfinal2 > 2070, 2070, pensionesfinal2),
35 * 12 <= numero_imposiciones & numero_imposiciones <= 39 * 12 ~ ifelse(pensionesfinal2 > 2300, 2300, pensionesfinal2),
4 * 120 <= numero_imposiciones ~ ifelse(pensionesfinal2 > 2530, 2530, pensionesfinal2),
TRUE ~ pensionesfinal2
))
sum(is.na(pensiones2$promedio_sueldo_real))
dim(prom_salario_a_usar[pensiones2$prom_salario_a_usar !=0]))
prom_salario_a_usar[pensiones2$prom_salario_a_usar !=0])
prom_salario_a_usar[pensiones2$prom_salario_a_usar !=0]
pensiones2$prom_salario_a_usar[pensiones2$prom_salario_a_usar !=0]
length(pensiones2$prom_salario_a_usar[pensiones2$prom_salario_a_usar ==0])
length(pensiones2$pensionesfinal2[pensiones2$pensionesfinal2 ==0])
length(pensiones2$numero_imposiciones[pensiones2$numero_imposiciones ==0])
min(pensiones2$edad_jubilacion)
max(pensiones2$edad_jubilacion)
quantile(pensiones2$edad_jubilacion)
table(pensiones2$edad_jubilacion)
4231/29100
shiny::runApp()
runApp()
runApp()
shiny::runApp()
=======
names(pensiones2)
which(pensiones2$anios_derecho_concedido <0)
pensiones2$anios_derecho_concedido[27747]
pensiones2$anios_derecho_concedido[27885]
pensiones2$anios_derecho_concedido[28203]
pensiones2$anios_derecho_concedido[28258]
pensiones2$anios_derecho_concedido[28273]
pensiones2$anios_derecho_concedido[28501]
pensiones2$anios_derecho_concedido[28517]
# Indicadores sobre población pensionada ---------------------------------------
pensiones2 <- pensiones2 %>% mutate(anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
pensiones2$numero_imposiciones_totales
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.1))
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.05))
quantile(pensiones2$edad_jubilacion,probs = seq(0,1,0.01))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18,
promedio_sueldo_real>0) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
quantile(pensiones2$promedio_sueldo_real,probs = seq(0,1,0.01))
pen_fem <- pensiones2 %>% filter(sexo=="F") %>%
mutate(edad_hoy=floor(as.numeric(ymd(today())-ymd(fecha_nacimiento_concesion))/365),
anios_derecho_concedido=floor(as.numeric(ymd(fecha_inicial_pension)-ymd(fecha_derecho))/365) )  %>% #select(edad_hoy) %>%
filter(edad_hoy<=108,
numero_imposiciones_totales>=10,
valor_pension_concedida>0,
edad_jubilacion>=numero_imposiciones_totales/12 + 18) %>%
select(edad_hoy,
edad_jubilacion,
promedio_sueldo_real,
numero_imposiciones_totales,
valor_acumulado,
coeficiente_real,
valor_pension_concedida,
fecha_derecho,
anios_derecho_concedido,
fecha_inicial_pension
) %>%  summary()
view(pen_fem)
which(pensiones2$numero_imposiciones_totales==60)
pensiones2$edad_jubilacion[782]
a <- which(pensiones2$numero_imposiciones_totales==60)
pensiones2$edad_jubilacion[a]
summary(pensiones2$edad_jubilacion[a])
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.01))
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.005))
quantile(pensiones2$coeficiente_real,probs = seq(0,1,0.01))
quantile(pensiones2$valor_pension_concedida,probs = seq(0,1,0.01))
a <- which(pensiones2$valor_pension_concedida==10.9000)
which(pensiones2$valor_pension_concedida==10.9000)
pensiones2$fecha_nacimiento_concesion[419]
2024-1932
quantile(pensiones2$fecha_inicial_pension,probs = seq(0,1,0.01))
quantile(pensiones2$ymd(fecha_inicial_pension),probs = seq(0,1,0.01))
quantile(ymd(pensiones2$fecha_inicial_pension),probs = seq(0,1,0.01))
summary(ymd(pensiones2$fecha_inicial_pension),probs = seq(0,1,0.01))
files()
list.files()
load("bases_originales/bases_cotizacion.Rdata")
load("bases_originales/bases_cotizacion.Rdata")
load("bases_originales/afiliados.Rdata")
load("~/TIC/Shiny-TIC/bases_originales/KSRECTPLANILLAS.RData")
View(ev_res2)
View(KSRECTPLANILLAS)
load("bases_originales/KSRECTPLANILLAS.RData")
names(bases_cotizacion)
names(afiliados)
afiliados$estafi
names(afiliados)
unique(afiliados$numjub)
names(KSRECTPLANILLAS)
summary(bases_cotizacion$sexo)
summarise(bases_cotizacion$sexo)
summary(as.factor(bases_cotizacion$sexo))
summary(as.factor(afiliados$sexo))
summarise(as.factor(afiliados$sexo))
722667(722667 + 1046075)
722667/(722667 + 1046075)
1046075/(722667 + 1046075)
#bases
552962 / (552962 + 710690)
710690 / (552962 + 710690)
100-40.86
summary(pensiones2$sexo)
summary(as.factor(pensiones2$sexo))
18059/(18059 + 27778 )
100-39.40
summarise(bases_cotizacion$valaponor)
summary(bases_cotizacion$valaponor)
summary(as.factor(afiliados$edad))
summary(afiliados$edad)
summary(as.factor(afiliados$estfal))
summary(ymd(afiliados$feciniafi))
afiliados %>% filter(estfal==0) %>% select(feciniafi) %>% summarise()
afiliados %>% filter(estfal==0) %>% select(feciniafi) %>% summary()
which(afiliados$feciniafi=="0101-03-20")
summary(afiliados$numimptot)
afiliados %>% filter(estfal==0) %>% select(numimptot) %>% summary()
summary(afiliados$numimp)
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summary()
a <- afiliados %>% filter(estfal==0) %>% select(numimp)
quantile(a,probs = seq(0,1,0.1))
a <- afiliados %>% filter(estfal==0) %>% select(numimp)
quantile(a,probs = seq(0,1,0.1))
a
quantile(as.vector(a),probs = seq(0,1,0.1))
class(a)
str(a)
quantile(a[1,],probs = seq(0,1,0.1))
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
summary(as.factor(afiliados$estfal))
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0.1),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0.1),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0,numimp>0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1)
)
afiliados %>% filter(estfal==0,numimp>0) %>% select(numimp) %>% summarise(
Q0 = quantile(numimp, probs = 0),
Q25 = quantile(numimp, probs = 0.25),
Q50 = quantile(numimp, probs = 0.5),
Q75 = quantile(numimp, probs = 0.75),
Q100 = quantile(numimp, probs = 1),
mean = mean(numimp)
)
=======
shiny::runApp()
shiny::runApp()
<<<<<<< HEAD
shiny::runApp()
runApp()
=======
>>>>>>> 386a2893c23d29648657741e475b4adf373e932a
>>>>>>> c560e7cc15453284badb8f598369c196a66a2493
>>>>>>> b81a273bca689ec1f1ce414b25deff0068139bd0
